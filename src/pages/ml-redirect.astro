// Callback OAuth Mercado Libre (uso interno, sin indexación)
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Callback Mercado Libre</title>
    <meta name="robots" content="noindex, nofollow" />
    <style>
      body { font-family: system-ui, Arial, sans-serif; background:#0f172a; color:#f1f5f9; margin:0; padding:2rem; }
      .wrap { max-width:760px; margin:0 auto; background:#1e293b; border:1px solid #334155; padding:2rem 2.25rem; border-radius:1.25rem; box-shadow:0 10px 25px -8px rgba(0,0,0,.55); }
      h1 { margin:0 0 1rem; font-size:1.5rem; line-height:1.2; font-weight:800; }
      code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace; font-size:.75rem; }
      pre { background:#0f172a; padding:1rem; border:1px solid #334155; border-radius:.75rem; overflow:auto; line-height:1.35; }
      .badge { display:inline-block; background:#2563eb; color:#fff; font-weight:600; font-size:.65rem; letter-spacing:.5px; padding:.35rem .55rem; border-radius:.5rem; vertical-align:middle; }
      .panel { background:#0f172a; border:1px solid #334155; padding:1rem 1.1rem; border-radius:.85rem; margin-top:1rem; }
      .status { border:1px solid; padding:.85rem 1rem; border-radius:.85rem; font-size:.7rem; margin-bottom:1.25rem; line-height:1.2; }
      .ok { background:rgba(16,185,129,.15); border-color:rgba(16,185,129,.45); color:#6ee7b7; }
      .warn { background:rgba(245,158,11,.15); border-color:rgba(245,158,11,.45); color:#fcd34d; }
      .err { background:rgba(239,68,68,.15); border-color:rgba(239,68,68,.45); color:#fca5a5; }
      .row { display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; }
      button { cursor:pointer; }
      .btn { background:#2563eb; color:#fff; border:none; padding:.45rem .85rem; font-size:.6rem; font-weight:600; border-radius:.5rem; letter-spacing:.5px; display:inline-flex; gap:.35rem; }
      .btn:hover { background:#1d4ed8; }
      footer { margin-top:2.5rem; text-align:center; font-size:.55rem; opacity:.55; }
      .toast { position:fixed; bottom:1rem; right:1rem; background:#0f172a; border:1px solid #334155; color:#e2e8f0; padding:.55rem .9rem; font-size:.6rem; border-radius:.5rem; box-shadow:0 4px 16px -4px rgba(0,0,0,.4); animation:fade .25s ease-out; }
      @keyframes fade { from { opacity:0; transform:translateY(4px);} to { opacity:1; transform:translateY(0);} }
      #codeArea { display:none; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1><span class="badge">ML</span> Callback OAuth Mercado Libre</h1>
      <div id="statusBox"></div>
      <div id="codeArea" class="panel">
        <p style="margin:.2rem 0 .5rem; font-size:.7rem; opacity:.7">Código recibido:</p>
        <div class="row">
          <code id="authCode" style="color:#6ee7b7; word-break:break-all; font-size:.7rem;"></code>
          <button id="copyCodeBtn" class="btn">Copiar</button>
        </div>
        <div class="panel" style="margin-top:1rem;">
          <p style="margin:.2rem 0 .6rem; font-size:.7rem; font-weight:600;">Intercambiar por tokens (curl)</p>
          <pre id="curlSnippet"></pre>
          <button id="copyCurlBtn" class="btn" style="margin-top:.5rem;">Copiar comando</button>
        </div>
        <details class="panel" style="margin-top:1rem;">
          <summary style="font-size:.65rem; font-weight:600;">¿Qué hacer con el refresh_token?</summary>
          <p style="margin-top:.5rem; font-size:.6rem; opacity:.75; line-height:1.35">Al intercambiar obtendrás <code>access_token</code> y <code>refresh_token</code>. Guarda este último para renovar (grant_type=refresh_token).</p>
        </details>
      </div>
      <footer>Uso interno • Tecnomata</footer>
    </div>

    <script is:inline>
      // @ts-nocheck
      (function(){
        var BASE = 'https://tecnomata.com';
        var qs = new URLSearchParams(location.search);
        var code = qs.get('code');
        var state = qs.get('state');
        var error = qs.get('error');
        var errorDesc = qs.get('error_description');
        var statusBox = document.getElementById('statusBox');
        var codeArea = document.getElementById('codeArea');
        var authCodeEl = document.getElementById('authCode');
        var curlSnippet = document.getElementById('curlSnippet');

        function setStatus(msg, kind){
          if(!statusBox) return;
            statusBox.className = 'status ' + (kind||'');
            statusBox.innerHTML = msg;
        }
        if(error){
          setStatus('<strong>Error:</strong> '+error+(errorDesc? ' <em style="opacity:.6">'+errorDesc+'</em>':''), 'err');
          return;
        }
        if(!code){
          setStatus('No se recibió ningún parámetro <code>code</code>.', 'warn');
          return;
        }
        setStatus('Autorización completada '+(state? '<span style="opacity:.6">(state: '+state+')</span>':''), 'ok');
        if(codeArea) codeArea.style.display = 'block';
        if(authCodeEl) authCodeEl.textContent = code;

        var redirectUri = BASE + '/ml-redirect';
        var curl = "curl -X POST \\\n  'https://api.mercadolibre.com/oauth/token' \\\n  -H 'Accept: application/json' \\\n  -d grant_type=authorization_code \\\n  -d client_id=CLIENT_ID_AQUI \\\n  -d client_secret=CLIENT_SECRET_AQUI \\\n  -d code=" + code + " \\\n  -d redirect_uri=" + redirectUri;
        if(curlSnippet) curlSnippet.textContent = curl;

        function toast(txt){
          var t = document.createElement('div');
          t.className = 'toast';
          t.textContent = txt;
          document.body.appendChild(t);
          setTimeout(function(){ t.remove(); }, 2200);
        }
        var copyCodeBtn = document.getElementById('copyCodeBtn');
        if(copyCodeBtn) copyCodeBtn.addEventListener('click', function(){ navigator.clipboard.writeText(code||'').then(function(){ toast('Código copiado'); }); });
        var copyCurlBtn = document.getElementById('copyCurlBtn');
        if(copyCurlBtn) copyCurlBtn.addEventListener('click', function(){ navigator.clipboard.writeText(curl).then(function(){ toast('Comando copiado'); }); });
      })();
    </script>
  </body>
</html>
